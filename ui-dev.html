<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>æ¬ å¸­é€£çµ¡ãƒ•ã‚©ãƒ¼ãƒ  - UIé–‹ç™ºãƒ¢ãƒ¼ãƒ‰</title>
  <link rel="stylesheet" href="css/style.css">
  <!-- LIFF SDKå®Œå…¨å‰Šé™¤ -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

</head>
<body>
    <!-- æ—¢å­˜ã®ãƒ•ã‚©ãƒ¼ãƒ HTMLã‚’ãã®ã¾ã¾ -->
        <h3>æ¬ å¸­ãƒ»é…åˆ»é€£çµ¡ãƒ•ã‚©ãƒ¼ãƒ </h3>
        <!--
            <div style="font-size:13px;color:#555;">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: <span id="userId">èª­ã¿è¾¼ã¿ä¸­...</span></div>
        -->

        <form id="absenceForm">
          <div class="form-field">
            <label>æ¬ å¸­ãƒ»é…åˆ»æ—¥</label>
            <input type="date" id="nextdate" required class="date-input">
          </div>

            <label>æ¬ å¸­ãƒ»é…åˆ»ç†ç”±</label>
            <select id="reason">
            <option value="ä½“èª¿ä¸è‰¯">ä½“èª¿ä¸è‰¯</option>
            <option value="é€šé™¢">é€šé™¢</option>
            <option value="å®¶åº­äº‹æƒ…">å®¶åº­äº‹æƒ…</option>
            <option value="ãã®ä»–">ãã®ä»–</option>
            </select>

            <label>è©³ç´°ï¼ˆç—‡çŠ¶ãªã©ï¼‰</label>
            <textarea id="details" rows="2" placeholder="ç™ºç†±ãƒ»é ­ç—›ãªã©è©³ã—ãæ•™ãˆã¦ãã ã•ã„"></textarea>

            <label>é€šé™¢æœ‰ç„¡ãƒ»äºˆå®š</label>
            <select id="medical">
            <option value="äºˆå®šãªã—">äºˆå®šãªã—</option>
            <option value="å—è¨ºäºˆå®šã‚ã‚Š">å—è¨ºäºˆå®šã‚ã‚Š</option>
            <option value="å—è¨ºæ¸ˆã¿">å—è¨ºæ¸ˆã¿</option>
            </select>

          <div class="form-field">
            <label>æ¬¡å›é€šæ‰€äºˆå®šæ—¥</label>
            <input type="date" id="nextVisitDate" class="nextDate-input">
          </div>
          <div class="form-field">
            <label>é…åˆ»äºˆå®šï¼ˆæ™‚åˆ»ãŒåˆ†ã‹ã‚‹å ´åˆï¼‰</label>
            <input type="time" id="nextVisitTime" class="time-input">
          </div>
        </form>

        <button id="sendBtn" onclick="submitAbsence()">é€ä¿¡</button>

        <script>
            async function initLiff(){
            await liff.init({ liffId:'2008783538-yHgAa1tC' });
            if(!liff.isLoggedIn()) return liff.login({ redirectUri: location.href });
            const id = liff.getDecodedIDToken().sub;
            document.getElementById('userId').textContent = id.substring(0,20)+'...';
            }

        async function submitAbsence() {
        const idToken = liff.getDecodedIDToken();
        const data = {
            userId: idToken.sub,
            reason: document.getElementById('reason').value,
            details: document.getElementById('details').value,
            medical: document.getElementById('medical').value,
            nextdate: document.getElementById('nextdate').value,
            nexttime: document.getElementById('nextVisitTime').value,
            nextvisit: document.getElementById('nextVisitDate').value
        };

        try {
            const query = new URLSearchParams(data);
            await fetch(GAS_URL + '?' + query.toString());

            await liff.sendMessages([{
            type: 'text',
            text: `ã€æ¬ å¸­é€£çµ¡ã€‘
        ç†ç”±: ${data.reason}
        è©³ç´°: ${data.details || '-'}
        é€šé™¢: ${data.medical}
        æ¬ å¸­æ—¥: ${data.nextdate}
        æ¬¡å›äºˆå®š: ${data.nextvisit || '-'} ${data.nexttime || ''}`
            }]);

            alert('âœ… é€ä¿¡ã—ã¾ã—ãŸã€‚ã”é€£çµ¡ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚');

        } catch (error) {
            console.error('é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
            alert('âš ï¸ é€ä¿¡å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
        } finally {
            // çµ¶å¯¾ã«é–‰ã˜ã‚‹å‡¦ç†
            if (liff.isInClient()) {
            liff.closeWindow();
            } else {
            // ãƒ–ãƒ©ã‚¦ã‚¶ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å¾Œãƒªãƒ­ãƒ¼ãƒ‰
            location.href = 'https://line.me/R/nv/chat';
            }
        }
        }

            initLiff();
        </script>

  <!-- UIé–‹ç™ºãƒ¢ãƒ¼ãƒ‰ç”¨ãƒ˜ãƒƒãƒ€ãƒ¼è¿½åŠ  -->
  <div style="background:#00b900;color:white;padding:12px;text-align:center;font-weight:bold;">
    ğŸ¨ UIé–‹ç™ºãƒ¢ãƒ¼ãƒ‰ï¼ˆLive Serverå°‚ç”¨ï¼‰
  </div>
  
  <script>
    // ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿è‡ªå‹•å…¥åŠ›
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('userId').value = 'U8f7d7d2a3e38979c0f5636ec968bacc9ï¼ˆè‡ªåˆ†ï¼‰';
      document.querySelector('button[type=submit]').onclick = function(e) {
        e.preventDefault();
        alert('âœ… ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æˆåŠŸï¼\n\nã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆè¨˜éŒ²ç¢ºèªæ¸ˆã¿\n\nUIèª¿æ•´ã‚’ç¶šã‘ã¦ãã ã•ã„');
      };
    });
  </script>
</body>
</html>
