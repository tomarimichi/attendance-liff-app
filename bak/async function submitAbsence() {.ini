async function submitAbsence() {
  // ãƒœã‚¿ãƒ³ãƒ‡ã‚£ã‚¹ã‚¨ãƒ¼ãƒ–ãƒ«ï¼ˆé€£æ‰“é˜²æ­¢ï¼‰
  const submitBtn = document.getElementById('sendBtn');
  submitBtn.disabled = true;
  submitBtn.textContent = 'é€ä¿¡ä¸­...âŒ›';




  // â˜…å¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯
  const required = {
    nextdate: 'æ¬ å¸­ãƒ»é…åˆ»æ—¥',
    reason: 'æ¬ å¸­ãƒ»é…åˆ»ç†ç”±',
    nextVisitDate: 'æ¬¡å›é€šæ‰€äºˆå®šæ—¥'
  };

  for (let [id, label] of Object.entries(required)) {
    const element = document.getElementById(id);
    if (!element.value.trim()) {
      alert(`${label}ã‚’é¸æŠ/å…¥åŠ›ã—ã¦ãã ã•ã„`);
      submitBtn.disabled = false;
      submitBtn.textContent = 'é€ä¿¡';
      element.focus();
      element.scrollIntoView({behavior: 'smooth'});
      return;
    }
  }

    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼è¡¨ç¤ºï¼ˆCDNå¿…é ˆï¼‰
    const bar = new ProgressBar.Line('#progress', {color: '#007bff', duration: 6000});
    bar.animate(1.0);  // 6ç§’ã‚¢ãƒ‹ãƒ¡é–‹å§‹
  

  try {
    // å³æ™‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    setTimeout(() => {
      submitBtn.textContent = 'é€ä¿¡ä¸­...â³';
    }, 100);


    const formData = new FormData(document.getElementById('absenceForm'));
    const params = Object.fromEntries(formData.entries());

    // LIFF userIdè¿½åŠ ï¼ˆå®‰å…¨å–å¾—ï¼‰
    let userId = 'web-user';
    try {
      const idToken = liff.getDecodedIDToken();
      params.userId = idToken.sub;
    } catch(e) {
      params.userId = userId;
    }

    console.log('ğŸ”¥ é€ä¿¡ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:', params);

    // GASé€ä¿¡ï¼ˆ1å›ã®ã¿ï¼‰
    const query = new URLSearchParams(params);
    const response = await fetch(GAS_URL + '?' + query.toString());
  }catch(error) {
    console.error('é€ä¿¡ã‚¨ãƒ©ãƒ¼:',error)
  }

  // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹100%ã§ã‚¯ãƒ­ãƒ¼ã‚ºï¼ˆè¦–è¦šå®Œäº†æ„Ÿï¼‰
  setTimeout(() => {
    if (typeof liff !== 'undefined' && liff.isInClient()) {
      liff.closeWindow();
    }
  }, 6000);  // GASæ™‚é–“ã«åŒæœŸ

    /*
    if (response.ok) {
      alert('âœ… é€ä¿¡å®Œäº†ï¼\nï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ï¼‹LW Boté€šçŸ¥ç¢ºèªï¼‰');
    } else {
      alert('âŒ é€ä¿¡ã‚¨ãƒ©ãƒ¼ï¼ˆç®¡ç†è€…ã«é€£çµ¡ï¼‰');
    }
  } catch (error) {
    console.error('é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
    alert('âŒ é€ä¿¡ã‚¨ãƒ©ãƒ¼: ' + error.message);
  } finally {
    // 3ç§’å¾Œã«ãƒœã‚¿ãƒ³å¾©æ´»
    setTimeout(() => {
      submitBtn.disabled = false;
      submitBtn.textContent = 'é€ä¿¡ä¸­...âŒ›';
    }, 3000);
  */
    /*
    // LIFFå†…ãªã‚‰ã‚¯ãƒ­ãƒ¼ã‚º
    if (typeof liff !== 'undefined' && liff.isInClient()) {
      liff.closeWindow();
    }

  }
    */

  
}


1101 ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼å®Œå…¨å‹•ä½œ(æ™‚é–“å›ºå®š)
async function submitAbsence() {
  const submitBtn = document.getElementById('sendBtn');
  submitBtn.disabled = true;
  submitBtn.textContent = 'é€ä¿¡ä¸­...â³';  // å³æ™‚0.1ç§’ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

  // å¿…é ˆãƒã‚§ãƒƒã‚¯ï¼ˆæ—¢å­˜OKï¼‰
  const required = { nextdate: 'æ¬ å¸­ãƒ»é…åˆ»æ—¥', reason: 'æ¬ å¸­ãƒ»é…åˆ»ç†ç”±', nextVisitDate: 'æ¬¡å›é€šæ‰€äºˆå®šæ—¥' };
  for (let [id, label] of Object.entries(required)) {
    const element = document.getElementById(id);
    if (!element.value.trim()) {
      alert(`${label}ã‚’é¸æŠ/å…¥åŠ›ã—ã¦ãã ã•ã„`);
      submitBtn.disabled = false;
      submitBtn.textContent = '>é€ä¿¡';
      element.focus();
      return;
    }
  }

  // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹é–‹å§‹ï¼ˆ6ç§’ã‚¢ãƒ‹ãƒ¡ï¼‰
  let bar;
  try {
    bar = new ProgressBar.Line('#progress', { strokeWidth: 4, color: '#007bff', duration: 6000 });
    bar.animate(1.0);
  } catch (e) {
    console.error('ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ã‚¨ãƒ©ãƒ¼:', e);  // CDNæœªèª­æ™‚ã¯ã‚¹ã‚­ãƒƒãƒ—
  }

  // GAS fire-and-forgetï¼ˆä¸¦åˆ—ä¸è¦ï¼‰
  const formData = new FormData(document.getElementById('absenceForm'));
  const params = Object.fromEntries(formData);
  try {
    let userId = 'web-user';
    const idToken = liff.getDecodedIDToken();
    params.userId = idToken.sub;
  } catch(e) { params.userId = userId; }
  const query = new URLSearchParams(params);
  fetch(GAS_URL + '?' + query).catch(console.error);

  // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹å®Œäº†ã§ã‚¯ãƒ­ãƒ¼ã‚ºï¼ˆç´å¾—æ„Ÿæœ€é«˜ï¼‰
  setTimeout(() => {
    if (liff?.isInClient()) liff.closeWindow();
  }, 6200);  // å°‘ã—ä½™è£•
}
