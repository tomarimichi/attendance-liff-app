<!DOCTYPE html>
<html lang="ja">
<head>
  <!--ãƒ†ã‚¹ãƒˆç”¨ã€€å¾Œã§æ¶ˆã™-->
  <meta name="last-updated" content="2026/01/15 13;39">

  <!-- GAS_URL -->
  <script>
    const GAS_URL ='https://script.google.com/macros/s/AKfycbwAhb_4arG3ZP73UrMvRQzkdhzXADcf-8QI1OGmV8Mp0W1wRrws2645qmUTEiDV97jK/exec';
  </script>
  
  <!--
    <script>
      // LIFFåˆæœŸåŒ–ã‚’å®Œå…¨ç„¡åŠ¹åŒ– + Mockãƒ¢ãƒ¼ãƒ‰
      window.addEventListener('DOMContentLoaded', function() {
        // LIFF SDKèª­ã¿è¾¼ã¿ã‚’ãƒ–ãƒ­ãƒƒã‚¯
        if (location.port === '5500' || location.hostname === '127.0.0.1' || location.hostname === 'localhost') {
          console.log('ğŸ”§ Live Server é–‹ç™ºãƒ¢ãƒ¼ãƒ‰');
          
          // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
          const statusDiv = document.createElement('div');
          statusDiv.id = 'dev-status';
          statusDiv.style.cssText = 'background:#00b900;color:white;padding:12px;border-radius:6px;margin:16px 0;text-align:center;font-weight:bold;position:fixed;top:10px;right:10px;z-index:9999;';
          statusDiv.textContent = 'ğŸ”§ é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ï¼ˆLive Serverï¼‰';
          document.body.insertBefore(statusDiv, document.body.firstChild);
          
          // userIdãƒ¢ãƒƒã‚¯
          const userIdInput = document.getElementById('userId');
          if (userIdInput) {
            userIdInput.value = 'U8f7d7d2a3e38979c0f5636ec968bacc9ï¼ˆè‡ªåˆ†ï¼‰';
            userIdInput.disabled = true;
          }
          
          // é€ä¿¡ãƒœã‚¿ãƒ³ãƒ¢ãƒƒã‚¯
          const submitBtn = document.querySelector('button[type="submit"], input[type="submit"], button');
          if (submitBtn) {
            submitBtn.style.background = '#ff6b35';
            submitBtn.textContent = 'âœ… é€ä¿¡ãƒ†ã‚¹ãƒˆï¼ˆãƒ¢ãƒƒã‚¯ï¼‰';
            submitBtn.onclick = function(e) {
              e.preventDefault();
              e.stopPropagation();
              statusDiv.textContent = 'ğŸ‰ é€ä¿¡æˆåŠŸï¼GASã«è¨˜éŒ²ã•ã‚Œã¾ã—ãŸ';
              statusDiv.style.background = '#00a300';
              setTimeout(() => {
                statusDiv.textContent = 'ğŸ”§ é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ï¼ˆLive Serverï¼‰';
                statusDiv.style.background = '#00b900';
              }, 3000);
            };
          }
        }
      }, true); // trueã§ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ•ã‚§ãƒ¼ã‚ºå®Ÿè¡Œï¼ˆLIFFã‚ˆã‚Šå…ˆã«å‡¦ç†ï¼‰
    </script>
  -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">


  
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <title>æ¬ å¸­ãƒ»é…åˆ»é€£çµ¡</title>
  <link rel="stylesheet" href="css/style.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
  <script src="https://cdn.jsdelivr.net/npm/progressbar.js@1.1.0/dist/progressbar.min.js"></script>
   -->
</head>

<body>
  <main class="container">
    <h1>æœ¬ç•ªç’°å¢ƒ</h1>
    <!--ãƒ†ã‚¹ãƒˆç”¨ã€€å¾Œã§æ¶ˆã™-->
    <p id="update-time">æ›´æ–°æ™‚é–“ãƒ»èª­ã¿è¾¼ã¿ä¸­...</p>

    <h3>æ¬ å¸­ãƒ»é…åˆ»é€£çµ¡ãƒ•ã‚©ãƒ¼ãƒ </h3>
    <!--
      <div style="font-size:13px;color:#555;">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: <span id="userId">èª­ã¿è¾¼ã¿ä¸­...</span></div>
    -->
    <form id="absenceForm" onsubmit="submitAbsence(); return false;">

      <div class="form-field">
        <label for="nextdate" class="required">æ¬ å¸­ãƒ»é…åˆ»æ—¥</label>
        <input type="date" id="nextdate" name="nextdate" required>
      </div>

      <label for="reason" class="required">æ¬ å¸­ãƒ»é…åˆ»ç†ç”±</label>
      <select id="reason" name="reason" required>
        <option value="" selected disabled>é¸æŠã—ã¦ãã ã•ã„</option><!--åˆæœŸå€¤-->
        <option value="ä½“èª¿ä¸è‰¯">ä½“èª¿ä¸è‰¯</option>
        <option value="é€šé™¢">é€šé™¢</option>
        <option value="å®¶åº­äº‹æƒ…">å®¶åº­äº‹æƒ…</option>
        <option value="ãã®ä»–">ãã®ä»–</option>
      </select>

      <label for="details">è©³ç´°ï¼ˆç—‡çŠ¶ãªã©ï¼‰</label>
      <textarea id="details" name="details" rows="2" placeholder="ç™ºç†±ãƒ»é ­ç—›ãªã©è‡ªç”±è¨˜å…¥"></textarea>

      <label for="medical">é€šé™¢æœ‰ç„¡ãƒ»äºˆå®š</label>
      <select id="medical" name="medical">
        <option value="äºˆå®šãªã—">äºˆå®šãªã—</option>
        <option value="å—è¨ºäºˆå®šã‚ã‚Š">å—è¨ºäºˆå®šã‚ã‚Š</option>
        <option value="å—è¨ºæ¸ˆã¿">å—è¨ºæ¸ˆã¿</option>
      </select>

      <div class="form-field">
        <label for="nextVisitDate" class="required">æ¬¡å›é€šæ‰€äºˆå®šæ—¥</label>
        <input type="date" id="nextVisitDate" name="nextvisit" class="nextDate-input" required>
      </div>
      <div class="form-field">
        <label for="nextVisitTime">é…åˆ»äºˆå®šï¼ˆæ™‚åˆ»ãŒåˆ†ã‹ã‚‹å ´åˆï¼‰</label>
        <input type="time" id="nextVisitTime" name="nexttime" class="time-input">
      </div>
      <button type="submit" id="sendBtn">>é€ä¿¡</button>
    </form>
    
    <!--ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼-->
    <div id="progress" style="width: 0%; height: 6px; background: #e0e0e0; margin: 10px 0; border-radius: 3px; overflow: hidden;">
      <div style="height: 100%; width: 0%; background: linear-gradient(90deg, #007bff, #00d4ff); transition: width 4s linear;"></div>
    </div>

<script>
// GAS/LIFFç”¨ã®æ—¢å­˜é–¢æ•°ï¼ˆãã®ã¾ã¾ä¿æŒï¼‰
async function initLiff(){
  await liff.init({ liffId:'2008783538-yHgAa1tC' });
  if(!liff.isLoggedIn()) return liff.login({ redirectUri: location.href });
  const id = liff.getDecodedIDToken().sub;
  document.getElementById('userId').textContent = id.substring(0,20)+'...';
}


async function submitAbsence() {
  const submitBtn = document.getElementById('sendBtn');
  submitBtn.disabled = true;
  submitBtn.textContent = 'é€ä¿¡ä¸­...â³';

  // â˜…å¿…é ˆãƒã‚§ãƒƒã‚¯
  const required = { nextdate: 'æ¬ å¸­ãƒ»é…åˆ»æ—¥', reason: 'æ¬ å¸­ãƒ»é…åˆ»ç†ç”±', nextVisitDate: 'æ¬¡å›é€šæ‰€äºˆå®šæ—¥' };
  for (let [id, label] of Object.entries(required)) {
    const element = document.getElementById(id);
    if (!element.value.trim()) {
      alert(`${label}ã‚’é¸æŠ/å…¥åŠ›ã—ã¦ãã ã•ã„`);
      submitBtn.disabled = false;
      submitBtn.textContent = '>é€ä¿¡';
      element.focus();
      return;
    }
  }

  // â˜…formDataå–å¾—ï¼‹userIdè¨­å®šï¼ˆã“ã‚ŒãŒæŠœã‘ã¦ã„ãŸï¼‰
  const formData = new FormData(document.getElementById('absenceForm'));
  const params = Object.fromEntries(formData.entries());
  try {
    params.userId = liff.getDecodedIDToken().sub;
  } catch(e) {
    params.userId = 'web-user';
  }
  console.log('é€ä¿¡ãƒ‡ãƒ¼ã‚¿:', params);

  // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹é–‹å§‹ï¼ˆè¦ª100%ï¼‹å­ã‚¢ãƒ‹ãƒ¡ï¼‰
  const progress = document.getElementById('progress');
  const progressFill = progress.querySelector('div');
  progress.style.width = '100%';     // è¦ªï¼šå³æ™‚è¡¨ç¤º
  progressFill.style.width = '100%'; // å­ï¼š4ç§’ã‚¢ãƒ‹ãƒ¡



  // â˜…GASé€ä¿¡ï¼ˆå¾©æ—§ï¼‰
    const startTime = performance.now();

    fetch(GAS_URL + '?' + new URLSearchParams(params))
      .then(response => {
        const elapsed = performance.now() - startTime;
        console.log('GASå¿œç­”:', response.status, `${elapsed}ms`);
        
        // 4ç§’ä»¥ä¸Šä¿è¨¼ï¼‹æœ€å¤§7ç§’åˆ¶é™
        const closeDelay = Math.min(Math.max(elapsed, 4000) + 300, 7000);
        console.log('ã‚¯ãƒ­ãƒ¼ã‚ºæ™‚é–“:', closeDelay, 'ms');
        
      setTimeout(() => {
        const closeElapsed = performance.now() - startTime;
        console.log(
          'closeWindowå®Ÿè¡Œ:',
          closeElapsed.toFixed(1),
          'ms'
        );
        liff?.closeWindow();
      }, closeDelay);

      })
      .catch(e => {
        const elapsed = performance.now() - startTime;
        console.error('GASã‚¨ãƒ©ãƒ¼:', e, `${elapsed}ms`);
        
        // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚æœ€å¤§7ç§’
        const closeDelay = Math.min(Math.max(elapsed + 1000, 4500), 7000);
        console.log('ã‚¨ãƒ©ãƒ¼ã‚¯ãƒ­ãƒ¼ã‚º:', closeDelay, 'ms');
        
      setTimeout(() => {
        const closeElapsed = performance.now() - startTime;
        console.log(
          'closeWindowï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ï¼‰å®Ÿè¡Œ:',
          closeElapsed.toFixed(1),
          'ms'
        );
        liff?.closeWindow();
      }, closeDelay);

      });

}





  

  document.addEventListener('DOMContentLoaded',function(){
  initLiff();
});

</script>

  <!--ãƒ†ã‚¹ãƒˆï¼šæ™‚é–“è¡¨ç¤ºç”¨(å¾Œã§æ¶ˆã™)-->
    <script>
      // GitHub Pagesæœ€çµ‚æ›´æ–°æ—¥è‡ªå‹•å–å¾—
      document.addEventListener('DOMContentLoaded', function() {
        const updateTime = document.getElementById('update-time');
        if (updateTime) {
          // GitHub Pagesã®ãƒ¡ã‚¿ã‚¿ã‚°ã‹ã‚‰æœ€çµ‚æ›´æ–°å–å¾—
          const meta = document.querySelector('meta[name="last-updated"]');
          if (meta && meta.content) {
            updateTime.textContent = `æœ€çµ‚æ›´æ–°ãƒ»${meta.content}`;
          } else {
            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šãƒ“ãƒ«ãƒ‰æ—¥æ™‚ï¼ˆæ‰‹å‹•æ›´æ–°ä¸è¦ï¼‰
            const now = new Date(Date.UTC(2026, 0, 9, 11, 10)); // JST+9è€ƒæ…®
            updateTime.textContent = `æœ€çµ‚æ›´æ–°ãƒ»${now.toLocaleString('ja-JP', {timeZone: 'Asia/Tokyo'})}`;
          }
        }
      });
    </script>


  </main>
</body>
</html>
